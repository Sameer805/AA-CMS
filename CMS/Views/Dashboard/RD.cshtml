
@{
    Layout = null;
}

<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <link rel="apple-touch-icon" sizes="76x76" href="../assets/img/apple-icon.png">
    <link rel="icon" type="image/png" href="assets/img/favicon.png">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1" />
    <title>
        Material Dashboard by Creative Tim
    </title>
    <meta content='width=device-width, initial-scale=1.0, shrink-to-fit=no' name='viewport' />
    <!--     Fonts and icons     -->
    <link rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:400,700|Material+Icons" />
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/latest/css/font-awesome.min.css">
    <!-- CSS Files -->
    <link href="~/Content/assets/css/material-dashboard.css" rel="stylesheet" />
    <!-- CSS Just for demo purpose, don't include it in your project -->
    <link href="~/Content/assets/demo/demo.css" rel="stylesheet" />
    <script src="~/Content/calendar/spin.min.js"></script>
</head>
<script>
    if (!(localStorage.getItem("admin") == "true")) {
        window.location.href = "../Home/";
    }
</script>
<body class="">

    <div id="loader"></div>
    <div class="wrapper ">
        <div class="sidebar" data-color="purple" data-background-color="white" data-image="~/Content/assets/img/sidebar-1.jpg">
            <!--
                Tip 1: You can change the color of the sidebar using: data-color="purple | azure | green | orange | danger"

                Tip 2: you can also add an image using data-image tag
            -->
            <div class="logo">
                <a class="simple-text logo-normal">
                    PEEKABEAR CALENDAR <br /> CALENDAR
                </a>
            </div>
            <div class="sidebar-wrapper">
                <ul class="nav">
                    <li class="nav-item">
                        <a class="nav-link" href="@Url.Action("Index", "Dashboard")">
                            <i class="material-icons">dashboard</i>
                            <p> Dashboard </p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="@Url.Action("Users", "Dashboard")">
                            <i class="material-icons">person</i>
                            <p>Users</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="@Url.Action("Venue", "Dashboard")">
                            <i class="material-icons">room</i>
                            <p>Venues</p>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="@Url.Action("EventType", "Dashboard")">
                            <i class="material-icons">library_books</i>
                            <p>Event Type</p>
                        </a>

                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="@Url.Action("RD", "Dashboard")">
                            <i class="material-icons">money</i>
                            <p>Refund / Discount</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="@Url.Action("EventList", "Dashboard")">
                            <i class="material-icons">library_books</i>
                            <p>Event List</p>
                        </a>
                    </li>
                    <li class="nav-item ">
                        <a class="nav-link" href="@Url.Action("Reports", "Dashboard")">
                            <i class="material-icons">library_books</i>
                            <p>Reports</p>
                        </a>
                    </li>

                    <li class="nav-item ">
                        <a class="nav-link" href="@Url.Action("Logout", "Home")">
                            <i class="material-icons">exit_to_app</i>
                            <p>Log Out</p>
                        </a>
                    </li>

                </ul>
            </div>
        </div>
        <div class="main-panel">
            <!-- Navbar -->
            <!-- End Navbar -->
            <div class="content">
                <div class="container-fluid">
                    <div class="col-lg-12   col-md-12">
                        <div class="card">
                            <div class="card-header text-white" style="background-color:#9c27b0">
                                <div class="row pr-3">

                                    <h4 class="m-3 card-title text-white">Discounts & Refunds</h4>

                                </div>

                            </div>
                            <div class="card-body row">
                                <div class="col-lg-6">
                                    <label>Booking ID:</label>

                                    <input type="text" class="form-control" id="booking_id" />
                                    <button class="btn btn-warning" id="search_bookingID">Search</button>

                                </div>
                                <div class="col-lg-6">

                                    <label>Phonenumber:</label>
                                    <input type="text" class="form-control" id="phonenumber" />
                                    <button class="btn btn-warning" id="search_phonenumber">Search</button>
                                </div>
                                <hr />
                                <input id="bookingID" style="display:none" />
                                <div class="col-lg-6">
                                    <label>Event Name:</label>
                                    <input type="text" class="form-control" id="eventname" disabled />
                                </div>
                                <div class="col-lg-6">
                                    <label>Event Date:</label>
                                    <input type="text" class="form-control" disabled id="eventdate" />
                                </div>
                                <div class="col-lg-6">
                                    <label>Customer Name:</label>
                                    <input type="text" class="form-control" id="customername" disabled />
                                </div>
                                <div class="col-lg-6">
                                    <label>Event Venue:</label>
                                    <input type="text" class="form-control" disabled id="eventvenue" />
                                </div>
                                <hr />

                                <input id="eventemail" style="display:none" />
                                <div class="container-fluid">
                                    <h4>Refund</h4>
                                    <div class="row">
                                        <div class="col-lg-6">
                                            <label>Select:</label>
                                            <select class="form-control">
                                                <option selected>Refund</option>
                                            </select>
                                        </div>
                                        <div class="col-lg-6">
                                            <label>Select Payment Type:</label>
                                            <select class="form-control" id="paymentoption">
                                                <option selected disabled value="0">Select Payment Type</option>
                                                <option value="1">Cash</option>
                                                <option value="2">Cheque</option>
                                                <option value="3">Credit Card</option>
                                            </select>
                                        </div>
                                        <div class="col-lg-6">
                                            <label>Bank Name:</label>
                                            <input type="text" class="form-control" id="bankname" />
                                        </div>
                                        <div class="col-lg-6">
                                            <label>Cheque Number:</label>
                                            <input type="number" class="form-control" id="chequenumber" />
                                        </div>
                                        <div class="col-lg-6">
                                            <label>Credit Card Number:</label>
                                            <input type="number" class="form-control" id="creditcardnumber" />
                                        </div>
                                        <div class="col-lg-6">
                                            <label>Amount:</label>
                                            <input type="number" class="form-control" id="amount" />
                                        </div>
                                        <div class="col-lg-12">
                                            <label>Remarks:</label>
                                            <input type="text" class="form-control" id="remarks" />
                                        </div>
                                        <button class="btn btn-success" onclick="addTransaction()">Add</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    </div>
    <div class="modal fade" id="mulitpleEvents" role="dialog">
        <div class="modal-dialog">

            <!-- Modal content-->
            <div class="modal-content">
                <div class="modal-header">
                    <h4 class="modal-title">Select Specific Event</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>

                </div>
                <div class="modal-body">
                    <table class="table table-bordered">
                        <tr>
                            <td>Booking ID</td>
                            <td>Booking Date</td>
                            <td>Event Name</td>
                            <td>Action</td>
                        </tr>
                        <tbody id="rows">
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>


    <!--   Core JS Files   -->
    <script src="~/Content/assets/js/core/jquery.min.js"></script>
    <script src="~/Content/assets/js/core/popper.min.js"></script>
    <script src="~/Content/assets/js/core/bootstrap-material-design.min.js"></script>
    <script src="~/Content/assets/js/plugins/perfect-scrollbar.jquery.min.js"></script>
    <!-- Plugin for the momentJs  -->
    <script src="~/Content/assets/js/plugins/moment.min.js"></script>
    <!--  Plugin for Sweet Alert -->
    <script src="https://unpkg.com/sweetalert/dist/sweetalert.min.js"></script>
    <!-- Forms Validations Plugin -->
    <script src="~/Content/assets/js/plugins/jquery.validate.min.js"></script>
    <!-- Plugin for the Wizard, full documentation here: https://github.com/VinceG/twitter-bootstrap-wizard -->
    <script src="~/Content/assets/js/plugins/jquery.bootstrap-wizard.js"></script>
    <!--	Plugin for Select, full documentation here: http://silviomoreto.github.io/bootstrap-select -->
    <script src="~/Content/assets/js/plugins/bootstrap-selectpicker.js"></script>
    <!--  Plugin for the DateTimePicker, full documentation here: https://eonasdan.github.io/bootstrap-datetimepicker/ -->
    <script src="~/Content/assets/js/plugins/bootstrap-datetimepicker.min.js"></script>
    <!--  DataTables.net Plugin, full documentation here: https://datatables.net/  -->
    <script src="~/Content/assets/js/plugins/jquery.dataTables.min.js"></script>
    <!--	Plugin for Tags, full documentation here: https://github.com/bootstrap-tagsinput/bootstrap-tagsinputs  -->
    <script src="~/Content/assets/js/plugins/bootstrap-tagsinput.js"></script>
    <!-- Plugin for Fileupload, full documentation here: http://www.jasny.net/bootstrap/javascript/#fileinput -->
    <script src="~/Content/assets/js/plugins/jasny-bootstrap.min.js"></script>
    <!--  Full Calendar Plugin, full documentation here: https://github.com/fullcalendar/fullcalendar    -->
    <script src="~/Content/assets/js/plugins/fullcalendar.min.js"></script>
    <!-- Vector Map plugin, full documentation here: http://jvectormap.com/documentation/ -->
    <script src="~/Content/assets/js/plugins/jquery-jvectormap.js"></script>
    <!--  Plugin ~/Content/for the Sliders, full documentation here: http://refreshless.com/nouislider/ -->
    <script src="~/Content/assets/js/plugins/nouislider.min.js"></script>
    <!-- Include a polyfill for ES6 Promises (optional) for IE11, UC Browser and Android browser support SweetAlert -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/core-js/2.4.1/core.js"></script>
    <!-- Library for adding dinamically elements -->
    <script src="~/Content/assets/js/plugins/arrive.min.js"></script>
    <!--  Google Maps Plugin    -->
    <script src="https://maps.googleapis.com/maps/api/js?key=YOUR_KEY_HERE"></script>
    <!-- Chartist JS -->
    <script src="~/Content/assets/js/plugins/chartist.min.js"></script>
    <!--  Notifications Plugin    -->
    <script src="~/Content/assets/js/plugins/bootstrap-notify.js"></script>
    <!-- Control Center for Material Dashboard: parallax effects, scripts for the example pages etc -->
    <script src="~/Content/assets/js/material-dashboard.js?v=2.1.2" type="text/javascript"></script>
    <!-- Material Dashboard DEMO methods, don't include it in your project! -->
    <script src="~/Content/assets/demo/demo.js"></script>
    <script src="~/Content/custom.js"></script>
    <script>
        var opts = {
            lines: 19, // The number of lines to draw
            length: 20, // The length of each line
            width: 2, // The line thickness
            radius: 38, // The radius of the inner circle
            scale: 1.05, // Scales overall size of the spinner
            corners: 0.3, // Corner roundness (0..1)
            speed: 1.3, // Rounds per second
            rotate: 45, // The rotation offset
            animation: 'spinner-line-fade-more', // The CSS animation name for the lines
            direction: -1, // 1: clockwise, -1: counterclockwise
            color: '#8f8f8f', // CSS color or array of colors
            fadeColor: 'transparent', // CSS color or array of colors
            top: '49%', // Top position relative to parent
            left: '50%', // Left position relative to parent
            shadow: '0 0 0px transparent', // Box-shadow for the lines
            zIndex: 2000000000, // The z-index (defaults to 2e9)
            className: 'spinner', // The CSS class to assign to the spinner
            position: 'absolute', // Element positioning
        };
        $("#loader").hide();
        var spinner = new Spinner(opts);
        $("#paymentoption").attr("disabled", "disabled");
        $(document).ajaxStart(function () {
            spinner.spin();
            $("#loader").show();
            var target = document.getElementById('loader');
            target.appendChild(spinner.el);


        });
        $(document).ajaxStop(function () {
            spinner.stop();
            $("#loader").hide();
        });
        $("#booking_id").keypress(function (e) {
            if (e.which == 13) {
                $("#search_bookingID").trigger("click");
            }
        });
         $("#phonenumber").keypress(function (e) {
            if (e.which == 13) {
                $("#search_phonenumber").trigger("click");
            }
        });
        
        $("#search_bookingID").click(function () {
            var id = $("#booking_id").val();
            $.ajax({
                type: "GET",
                url: "../Home/getEventFromId",
                data: { id: id },
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("Request: " + XMLHttpRequest.toString() + "\n\nStatus: " + textStatus + "\n\nError: " + errorThrown);
                },
                success: function (result) {
                    $("#mulitpleEvents").modal('hide');
                    if (result.result == [] || result.result == "" || result.result == null) {
                        swal("No record found!", "", "error");

                        $("#id_booking").val("");
                        $("#phonenumber_booking").val("");
                        return;
                    }
                    if (result.result[0].b.isBooked == false) {
                        swal("This event is Tentative!", "", "warning");

                        $("#id_booking").val("");
                        $("#phonenumber_booking").val("");
                        return;
                    }
                    $("#bookingID").val(result.result[0].b.id);
                    $("#customername").val(result.result[0].b.customerName);
                    $("#eventname").val(result.result[0].b.eventName);
                    $("#eventdate").val(new Date(result.result[0].b.bookingDate).toDateString());
                    $("#eventvenue").val(result.result[0].name);
                    $("#eventemail").val(result.result[0].b.email);
                    $("#paymentoption").removeAttr("disabled");
                }
            });
        });

        $("#search_phonenumber").click(function () {
            var phonenumber = $("#phonenumber").val();
            if (phonenumber.length != 11) {
                swal("Please Enter Valid Phone Number", "", "error");
                return;
            }
            $.ajax({
                type: "GET",
                url: "../Home/FetchEventDetail",
                data: { bookingid: 0, phonenumber: phonenumber },
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("Request: " + XMLHttpRequest.toString() + "\n\nStatus: " + textStatus + "\n\nError: " + errorThrown);
                },
                success: function (result) {
                    //Checking if two rows returned
                    if (result.length > 1) {
                        $("#rows").empty();
                        result.forEach(function (element, index) {
                            var row = "<tr><td>" + element.id + "</td><td>" + new Date(element.bookingDate).toDateString() + "</td><td>" + element.eventName + "</td><td><button class='btn btn-success select' id='" + element.id + "'>Select</button></td>";
                            $("#rows").append(row);
                        });

                        $("#id_booking").val("");
                        $("#mulitpleEvents").modal();
                    } else {

                        $("#id_booking").val("");
                        $.ajax({
                            type: "GET",
                            url: "../Home/ReturnIDByPhonenumber",
                            data: { phonenumber: phonenumber },
                            contentType: 'application/json; charset=utf-8',
                            dataType: 'json',
                            error: function (XMLHttpRequest, textStatus, errorThrown) {

                            },
                            success: function (result) {
                                 $.ajax({
                type: "GET",
                url: "../Home/getEventFromId",
                data: { id: result[0] },
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("Request: " + XMLHttpRequest.toString() + "\n\nStatus: " + textStatus + "\n\nError: " + errorThrown);
                },
                success: function (result) {
                    $("#mulitpleEvents").modal('hide');
                    

                    if (result.result == [] || result.result == "" || result.result == null) {
                        swal("No record found!", "", "error");

                        $("#id_booking").val("");
                        $("#phonenumber_booking").val("");
                        return;
                    }
                    if (result.result[0].b.isBooked == false) {
                        swal("This event is Tentative!", "", "warning").then(function () { location.reload() });

                        $("#id_booking").val("");
                        $("#phonenumber_booking").val("");
                        return;
                    }
                    $("#bookingID").val(result.result[0].b.id);
                    $("#customername").val(result.result[0].b.customerName);
                    $("#eventname").val(result.result[0].b.eventName);
                    $("#eventdate").val(new Date(result.result[0].b.bookingDate).toDateString());
                    $("#eventvenue").val(result.result[0].name);
                    $("#eventemail").val(result.result[0].b.email);
                    $("#paymentoption").removeAttr("disabled");
                }
            });

                            }


                        });

                    }
                }
            });
        });
            //Select button click after multiple events popup
        $(document).on("click", ".select", function () {
            var id = $(this).attr("id");
            $("#id_booking").val("");
             $.ajax({
                type: "GET",
                url: "../Home/getEventFromId",
                data: { id: id },
                contentType: 'application/json; charset=utf-8',
                dataType: 'json',
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log("Request: " + XMLHttpRequest.toString() + "\n\nStatus: " + textStatus + "\n\nError: " + errorThrown);
                },
                success: function (result) {
                    $("#mulitpleEvents").modal('hide');
                    console.log(result.result.slotname[0]);

                    if (result.result == [] || result.result == "" || result.result == null) {
                        swal("No record found!", "", "error");

                        $("#id_booking").val("");
                        $("#phonenumber_booking").val("");
                        return;
                    }
                    if (result.result[0].b.isBooked == false) {
                        swal("This event is Tentative!", "", "warning").then(function () { location.reload() });

                        $("#id_booking").val("");
                        $("#phonenumber_booking").val("");
                        return;
                    }
                    $("#bookingID").val(result.result[0].b.id);
                    $("#customername").val(result.result[0].b.customerName);
                    $("#eventname").val(result.result[0].b.eventName);
                    $("#eventdate").val(new Date(result.result[0].b.bookingDate).toDateString());
                    $("#eventvenue").val(result.result[0].name);
                    $("#eventemail").val(result.result[0].b.email);
                    $("#paymentoption").removeAttr("disabled");
                }
            });
        })
        $("#paymentoption").change(function () {

            $("#amount").val("");
            $("#bankname").val("");
            $("#chequenumber").val("");
            $("#creditcardnumber").val("");
            $("#amount").removeAttr("disabled");
            $("#bankname").removeAttr("disabled");
            $("#chequenumber").removeAttr("disabled");
            $("#creditcardnumber").removeAttr("disabled");

            var id = $(this).val();
            if (id == "1") {
                $("#bankname").attr("disabled", "disabled");
                $("#chequenumber").attr("disabled", "disabled");
                $("#creditcardnumber").attr("disabled", "disabled");
            } else if (id == "2") {
                $("#creditcardnumber").attr("disabled", "disabled");
            } else {
                $("#chequenumber").attr("disabled", "disabled");
            }
        })
        function addTransaction() {
            var error = false;
            $("#amount").css("border", "1px solid #ccc");
            $("#bankname").css("border", "1px solid #ccc");
            $("#creditcard").css("border", "1px solid #ccc");
            $("#chequenumber").css("border", "1px solid #ccc");
            var type = $("#paymentoption").val();
            var amount = $("#amount").val();
            var remarks = $("#remarks").val();
            var creditcardnumber;
            var bankname;
            var chequenumber;
            
            if (type == null) {
                $("#paymentoption").css("border", "1px solid red");
                return;
                error = true;
            }

            if (type == "1") {

            } else if (type == "2") {
                bankname = $("#bankname").val();
                chequenumber = $("#chequenumber").val();
                if (bankname == "") {
                    $("#bankname").css("border", "1px solid red");
                }
                if (chequenumber == "") {
                    $("#chequenumber").css("border", "1px solid red");
                    error = true;
                }
            }
            else if (type == "3") {
                bankname = $("#bankname").val();
                creditcardnumber = $("#creditcard").val();
                if (bankname == "") {
                    $("#bankname").css("border", "1px solid red");
                }
                if (creditcardnumber == "") {
                    $("#creditcard").css("border", "1px solid red");
                    error = true;
                }
            }
            if (amount == 0) {
                $("#amount").css("border", "1px solid red");
                error = true;
            }
            if (remarks == "" || remarks == null) {
                 $("#remarks").css("border", "1px solid red");
                error = true;
            }
            if (error) {
                return;
            }
            var bid = $("#bookingID").val();
            $.ajax({
                type: "GET",
                url: "../Home/AddTransaction",
                contentType: 'application/json; charset=utf-8',

                data: { bid: bid, amount: (parseInt(amount) * -1), bankname: bankname, creditcardnumber: creditcardnumber, chequenumber: chequenumber, type: type, remarks: remarks },
                error: function (XMLHttpRequest, textStatus, errorThrown) {
                    console.log(XMLHttpRequest);
                },
                success: function (_result) {
                    var body = "";
                                        $.ajax({
                        type: "GET",
                        url: "../Home/getEventFromId",
                        contentType: 'application/json; charset=utf-8',


                        dataType: 'json',
                        data: { id: bid },
                        error: function (XMLHttpRequest, textStatus, errorThrown) {
                            console.log(XMLHttpRequest);
                        },
                                            success: function (result) {
                                                
                                                 var bookedby = "";
                                    $.ajax({
                                        url: "FetchNameByUserID",    //the page containing php script
                                        type: "post",    //request type,
                                        dataType: "json",
                                        data: { id:result.result[0].b.booked_by},
                                        success: function (result2) {
                                            bookedby = result2;
                                        }
                                    });
                                                
                            $.ajax({
                                type: "GET",
                                url: "../Home/FetchTransactionsByBookingID",
                                data: { id: bid },
                                contentType: 'application/json; charset=utf-8',
                                dataType: 'json',
                                error: function (XMLHttpRequest, textStatus, errorThrown) {

                                },
                                success: function (_result) {
                                    var subject = "Refund: " + $("#eventname").val() + "    Venue: " + $("#eventvenue").val() + "    Event Date: " + new Date($("#eventdate").val()).toDateString();
                                   
                                    var from = "PEEKABEAR aajasmat@gmail.com";
                                    body += "PEEKABEAR. <br><table style='border: 1px solid black;width:600px'><thead>    <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;padding:5px;'>&nbsp;</th>      <th style='border: 1px solid black;padding:5px;'>Details</th>    </tr>  </thead>  <tbody><tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Booking ID</center></th>      <td style='border: 1px solid black;'><center>" + result.result[0].b.id  + "</center></td>    </tr><tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Event Name</center></th>      <td style='border: 1px solid black;'><center>" + result.result[0].b.eventName + "</center></td>    </tr>     <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Customer Name</center></th>      <td style='border: 1px solid black;'><center>" + result.result[0].b.customerName + "</center></td>      </tr>       <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Event Date</center></th>      <td style='border: 1px solid black;'><center>" + new Date(result.result[0].b.bookingDate).toDateString() + "</center></td>      </tr>       <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Venue</center></th>      <td style='border: 1px solid black;'><center>" + $("#eventvenue").val() + "</center></td>      </tr>       <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Event Time</center></th>      <td style='border: 1px solid black;'><center>" + result.slotname[0].slot+ "</center></td>      </tr>             <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>No of Guests</center></th>      <td style='border: 1px solid black;'><center>" + result.result[0].b.numberOfPersons + "</center></td>      </tr>          <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Status</center></th>      <td style='border: 1px solid black;'><center> "+(result.result[0].b.isBooked == true ? "Booked" : "Tentative")+" </center></td>      </tr>   <tr style='border: 1px solid black;'>      <th style='border: 1px solid black;'><center>Booked By</center></th>      <td style='border: 1px solid black;'><center>" +bookedby + "</center></td>      </tr>      </tbody></table><br>Paid Transations:<br><table style='border: 1px solid black;width:600px'><thead><tr style='border: 1px solid black;'><td style='border: 1px solid black;'>Transaction Index</td><td style='border: 1px solid black;'>Date - Time</td><td style='border: 1px solid black;'>Amount</td><td style='border: 1px solid black;'>Payment Type</td><td style='border: 1px solid black;'>Bank Name</td><td style='border: 1px solid black;'>Credit Card Number</td><td style='border: 1px solid black;'>Cheque Number</td></tr></thead><tbody>";
                                    var index = 0;
                                    _result.forEach(function (element) {

                                        var parameter = "";
                                        if (index == 0) {
                                            $("#advanceAmount").val(element.amount);
                                        }
                                        var type = "";

                                        if (element.paymentType == 1) {
                                            type = "Cash";
                                        }
                                        else if (element.paymentType == 2) {
                                            type = "Cheque";
                                        }
                                        else {
                                            type = "Credit Card";
                                        }
                                        var indexType = "";
                                        if (parseInt(element.amount) < 0) {
                                            parameter = "color:red";
                                            indexType = "Refund";

                                        } else {
                                            if (index == 0) {
                                                indexType = "Advance Payment";
                                            } else if (index == 1) {
                                                indexType = "Second Payment";
                                            }
                                            else if (index == 2) {
                                                indexType = "Third Payment";
                                            }
                                            else if (index == 3) {
                                                indexType = "Fourth Payment";
                                            }
                                            else if (index == 4) {
                                                indexType = "Fifth Payment";
                                            }
                                            else if (index == 5) {
                                                indexType = "Sixth Payment";
                                            }
                                            else if (index == 6) {
                                                indexType = "Seventh Payment";
                                            }
                                            else if (index == 7) {
                                                indexType = "Eighth Payment";
                                            }
                                            else if (index == 8) {
                                                indexType = "Ninth Payment";
                                            }
                                            else if (index == 9) {
                                                indexType = "Tenth Payment";
                                            }
                                            else if (index == 10) {
                                                indexType = "Eleventh Payment";
                                            }
                                            else if (index == 11) {
                                                indexType = "Twelfth Payment";
                                            }
                                            else if (index == 12) {
                                                indexType = "Thirteenth Payment";
                                            }
                                            else if (index == 13) {
                                                indexType = "Fourteenth Payment";
                                            }
                                            else if (index == 14) {
                                                indexType = "Fifteenth Payment";
                                            }
                                            index++;
                                        }



                                        body += "<tr style='border: 1px solid black;" + parameter + "'><td style='border: 1px solid black;'>" + indexType + "</td><td style='border: 1px solid black;'>" + new Date(element.insertedDateTime).toDateString() + "</td><td style='border: 1px solid black;'>" + element.amount + "</td><td style='border: 1px solid black;'>" + type + "</td><td style='border: 1px solid black;'>" + (element.bankName == '0' ? '-' : element.bankName) + "</td><td style='border: 1px solid black;'>" + (element.creditCardNumber == '0' ? '-' : element.creditCardNumber) + "</td><td style='border: 1px solid black;'>" + (element.chequeNumber == '0' ? '-' : element.chequeNumber) + "</td></tr>";
                                        if (indexType == "Refund") {
                                            body += "<tr style='border: 1px solid black;color:red'><td colspan='7' style='border:1px solid black;'>Remarks: " + element.remarks + "</td></tr>";
                                        }

                                    });
                                    body += "</tbody></table>";
                            var from = "PEEKABEAR aajasmat@gmail.com";
                            $.ajax({
                                url: "../Home/SendEmailNewEvent",    //the page containing php script
                                type: "post",    //request type,
                                data: { from: from, to: $("#eventemail").val(), body: body, subject: subject, BCC: ["aajasmat@gmail.com"] },
                                success: function (result) {

                                    swal("Refund Added", "", "success").then(function () {
                                        window.location.reload();
                                    });

                                }
                            });
                                }
                            });
                            

                        }


                    });
                }

            });


        }
    </script>
</body>
<style> hr {
            border: 0;
            clear: both;
            display: block;
            width: 96%;
            background-color: #ccc;
            height: 2px;
        }
  #loader {
            width: 100vw;
            height: 100vh;
            background-color: white;
            position: absolute;
            z-index: 100;
        }
</style>
</html>